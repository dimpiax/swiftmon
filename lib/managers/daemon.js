'use strict';var _classCallCheck2=require('babel-runtime/helpers/classCallCheck'),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require('babel-runtime/helpers/createClass'),_createClass3=_interopRequireDefault(_createClass2),_fs=require('fs'),_fs2=_interopRequireDefault(_fs),_child_process=require('child_process'),_safe=require('colors/safe'),_safe2=_interopRequireDefault(_safe),_config=require('../config'),_config2=_interopRequireDefault(_config);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var Daemon=function(){function a(){(0,_classCallCheck3.default)(this,a)}return(0,_createClass3.default)(a,[{key:'start',value:function start(){console.log(_safe2.default.yellow(_config2.default.data.title+' watching '+this.options.buildDir)),_fs2.default.watch(this.options.buildDir,this._watchHandler.bind(this)),this._restartProcess()}},{key:'destroy',value:function destroy(){this._killChild(),this._child=null}},{key:'_watchHandler',value:function _watchHandler(a,b){console.log(_safe2.default.gray('\n\''+(b||'unknown')+'\' file has been changed'),_safe2.default.green('restarting...')),this._restartProcess()}},{key:'_restartProcess',value:function _restartProcess(){var a='./.build/'+this.options.env+'/'+this.options.startScript;console.log(_safe2.default.green(_config2.default.data.title+' building and starting...')),this._killChild(),this._child=(0,_child_process.spawn)('swift build && '+a,{shell:!0,detached:!0}),null!=this._child.stderr&&this._child.stderr.on('data',function(a){console.error(a.toString().trim())}),null!=this._child.stdout&&this._child.stdout.on('data',function(a){console.log(a.toString().trim())}),this._child.on('exit',function(a){null==a||console.log('Exited with code: '+a)})}},{key:'_killChild',value:function _killChild(){null==this._child||process.kill(-this._child.pid)}}]),a}();exports.default=Daemon;